<!DOCTYPE html>
<html>
  
<head>
<title>Metal Archives Top 10 Albums Poll Results 2025</title>
<style type="text/css">
body {
    color: #c2b8af; /*  #FFF; */
    background-color: black; /* #FFF; */
    margin: 30px;
    margin-top: 10px;
}

h2 {
  color: #ad6854;
}

div.container {
  width: 700px;
  height: 700px;
  border-style: solid;
  border-width: 1px;
  border-radius: 6px;

}

div.container_header {
  border-style: none none solid none;
  border-width: 1px;
  border-color: #3e0b0a;
  color: #ad6854; /* rgb(173, 104, 84); #C2B8AF; */
  background-color: black; /* #3E0B0A; */
  text-align: center;
}

div.results_container {
  display: grid;
  grid-template-rows: 50px 40px;
  grid-template-columns: 70px 640px 70px;
  color: #ad6854;
  width: 780px;
  overflow: hidden;
  border-style: solid;
  border-width: 1px;
  border-radius: 6px;
  border-color: #3e0b0a;
  background-color: #110107
}

input.day_slider {
  width: 400px;
}

p.pos_label {
  text-align: center;
}

div.album {
  height: 35px;
  margin-top: 5px;
  margin-bottom: 5px;
  width: 705px;
  top: 400px;
  left: 0px;
  position: absolute;
  color: #c2b8af;
  border-style: solid;
  border-width: 1px;
  border-radius: 6px;
  border-color: #3e0b0a;
  display: flex;
  align-items: center;
  transition: left .5s ease-in, top 2.0s ease-in, background-color 2.0s ease-in, background-image 2.0s ease-in, opacity 2.0s ease-in;
}

.album .title {
  flex: 640;
  margin-left: 5px;
}

.album .points {
  flex: 70;
  text-align: center;
}

/*
div.albumheader {
  height: 35px;
  margin: 5px;
  width: 660px;
  display: flex;
  align-items: center;
}


.albumheader .title {
    flex: 7;
}

.albumheader .votes {
    flex: 1;
}
*/


</style>

<script>

const poll_results =
[
    { polldate: '',
      ballots: 0,
      results: []
    },
    { polldate: '3rd December 2025',
      ballots: 1,
      results:
        [
            { band_album: 'Album A', points: 22 },
            { band_album: 'Album B', points: 20 },
            { band_album: 'Album C', points: 18 },
            { band_album: 'Album D', points: 17 },
            { band_album: 'Album E', points: 15 },
            { band_album: 'Album F', points: 12 },
            { band_album: 'Album G', points: 9 },
            { band_album: 'Album H', points: 7 },
            { band_album: 'Album I', points: 4 },
            { band_album: 'Album J', points: 1 }
        ]
    },
    { polldate: '4th December 2025',
      ballots: 2,
      results:
        [
            { band_album: 'Album B', points: 25 },
            { band_album: 'Album A', points: 24 },
            { band_album: 'Album C', points: 20 },
            { band_album: 'Album D', points: 19 },
            { band_album: 'Album E', points: 16 },
            { band_album: 'Album F', points: 13 },
            { band_album: 'Album G', points: 9 },
            { band_album: 'Album H', points: 8 },
            { band_album: 'Album I', points: 4 },
            { band_album: 'Album K', points: 2 }
        ]
    },
    { polldate: '5th December 2025',
      ballots: 3,
      results:
        [
            { band_album: 'Album A', points: 34 },
            { band_album: 'Album B', points: 33 },
            { band_album: 'Album C', points: 26 },
            { band_album: 'Album F', points: 24 },
            { band_album: 'Album D', points: 20 },
            { band_album: 'Album E', points: 18 },
            { band_album: 'Album G', points: 13 },
            { band_album: 'Album I', points: 12 },
            { band_album: 'Album K', points: 10 },
            { band_album: 'Album J', points: 9 }
        ]
    },
    { polldate: '6th December 2025',
      ballots: 4,
      results:
        [
            { band_album: 'Album A', points: 41 },
            { band_album: 'Album B', points: 37 },
            { band_album: 'Album F', points: 33 },
            { band_album: 'Album C', points: 31 },
            { band_album: 'Album D', points: 23 },
            { band_album: 'Album X', points: 21 },
            { band_album: 'Album E', points: 18 },
            { band_album: 'Album G', points: 16 },
            { band_album: 'Album J', points: 13 },
            { band_album: 'Album I', points: 12 }
        ]
    }
];
const itemCount = 10;
const itemHeight = 40;
const itemWidth = 660;
const itemMargin = 5;
var   currentDay = -1;
var   playing = false;
var   playTimer;
const transitionMs = 2000;
const transitionDelayMs = 400;

const maTextHeadingColour = 0xad6854;
const maTextBodyColour = 0xc2b8af;
const maTextInfoColour = 0x838b98;
const maBorderColour = 0x3e0b0a;
const maBoxBackgroundColour1 = 0x110107;
const maBoxBackgroundColour2 = 0x101010;

const topColour = 0xffd700; // parseInt( 'ffd700', 16 );
const bottomColour = 0x996515; // parseInt( '996515', 16 );

const goldColour = 0xe5b80b; // 0xedc531;
const goldColour1 = 0xfad643;
const goldColour2 = 0xedc531;
const goldColour3 = 0xd4af37;

const silverColour = 0xc4c4c4; // 0xc0c0c0; // 0xd8d8d8;
const silverColour1 = 0xc4c4c4; // 0xc0c0c0; // 0xd8d8d8;
const silverColour2 = 0xc4c4c4; // 0xc0c0c0; // 0xd8d8d8;
const silverColour3 = 0xc0c0c0; // 0xc0c0c0; // 0xd8d8d8;

const bronzeColour1 = 0xce8946
const bronzeColour2 = 0xce8946
const bronzeColour3 = 0x9f7a34

const bronzeStartColour = 0xce8946
const bronzeEndColour = 0x804a00;

/*
var theThing;
var container;
*/

function create() {
    createContainer();
    createItemBoxes();
}
 
function orderItems()
{
    setBoxPositions();
}

function randomise()
{
    // Init choices
    var choices = new Array();
    for( let i = 0; i < 2 * itemCount; i++)
    {
        choices[ i ] = i + 1;
    }
    // Array.from({length: 40}, () => Math.floor(Math.random() * 40));

    for( let i = 0; i < 2 * itemCount; i++)
    {
        var box = document.getElementById( 'box' + ( i + 1 ).toString() );
        box.setAttribute( 'data-pos', itemCount + 1 );
        var ps = box.querySelectorAll( 'p' );
        ps[ 1 ].innerHTML = "";
    }

    // Choose itemCount items from the 2 * itemCount choices
    for( let i = 0; i < itemCount; i++)
    {
        var idx = Math.floor( Math.random() * ( itemCount * 2 - i ) );
        var boxNum = choices[ idx ];
        choices.splice( idx, 1 ); // Remove chosen item

        // Set box position rank and display text
        var box = document.getElementById( 'box' + boxNum );
        box.setAttribute( 'data-pos', i + 1 );
        var ps = box.querySelectorAll( 'p' );
        ps[ 1 ].innerHTML = i + 1; // Should properly randomise but then have to sort
    }
}

function togglePlay()
{
    var btn = document.getElementById( 'toggle_play' );
    if( playing )
    {
        clearTimeout( playTimer );
        btn.innerHTML = "▶";
    }
    else
    {
        playTimer = setTimeout( playNextDay, 100 ); // Do first one straight away
        btn.innerHTML = "⏸";
    }
    playing = !playing;
}

function rewind()
{
    setDay( 0 );
    if( playing )
    {
        // Restart playing
        clearTimeout( playTimer );
        playTimer = setTimeout( playNextDay, 100 );
    }
    else
    {
        setBoxPositions();
    }
}


function playNextDay()
{
    if( playing && currentDay < poll_results.length - 1 ) // Double-check
    {
        nextDay();
        setBoxPositions();
        playTimer = setTimeout( playNextDay, transitionMs + transitionDelayMs );
    }
    else
    {
        playing = false;
        var btn = document.getElementById( 'toggle_play' );
        btn.innerHTML = "▶";
    }
}


function getClickPosition(e) {
    var parentPosition = getPosition(e.currentTarget);
    var xPosition = e.clientX - parentPosition.x - (theThing.clientWidth / 2);
    var yPosition = e.clientY - parentPosition.y - (theThing.clientHeight / 2);
     
    theThing.style.left = xPosition + "px";
    theThing.style.top = yPosition + "px";
}
 
// Helper function to get an element's exact position
function getPosition(el) {
  var xPos = 0;
  var yPos = 0;
 
  while (el) {
    if (el.tagName == "BODY") {
      // deal with browser quirks with body/window/document and page scroll
      var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
      var yScroll = el.scrollTop || document.documentElement.scrollTop;
 
      xPos += (el.offsetLeft - xScroll + el.clientLeft);
      yPos += (el.offsetTop - yScroll + el.clientTop);
    } else {
      // for all other non-BODY elements
      xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
      yPos += (el.offsetTop - el.scrollTop + el.clientTop);
    }
 
    el = el.offsetParent;
  }
  return {
    x: xPos,
    y: yPos
  };
}

function numToColour( num )
{
    return "#" + ( num & 0x00FFFFFF ).toString( 16 ).padStart( 6, '0' )
}

function createContainer()
{
    // Set grid row repeats for results
    var cont = document.getElementById( 'results_container' );
    cont.style.gridTemplateRows = "50px repeat( " + itemCount + ", 40px ) 45px";

    // Create position ranks
    for( let i = 0; i < itemCount; i++)
    {
        const p = document.createElement( "p" );
        p.setAttribute( 'class', 'pos_label' );
        // p.style.gridRow = ( i + 2 ) + " / " + ( i + 3 );
        p.style.gridRow = i + 2;
        p.style.gridColumn = 1;
        p.innerHTML = i + 1;
        cont.appendChild( p );
    }

    // Create black bar for extra final row to hide items
    const blk = document.createElement( "div" );
    blk.style.gridRow = ( itemCount + 2 ) + " / " + ( itemCount + 3 );
    blk.style.gridColumn = "1 / 4";
    blk.style.backgroundColor = 'black';
    cont.appendChild( blk );

    // Set up slider rnage
    var slider = document.getElementById("day_in_poll");
    slider.min = slider.value = 0;
    slider.max = poll_results.length - 1;
}

function createItemBoxes()
{
    // TODO: transition not working immediately after div creation, needs some sort of refresh maybe?
    // For now have put the ordering behind a second button

    // Need double the ranking in case all new results
    for( let i = 0; i < 2 * itemCount; i++)
    {
        const ib = document.createElement("div");
        ib.setAttribute( 'class', 'album' );
        ib.setAttribute( 'data-pos', Math.min( i + 1, itemCount + 1 ) );
        ib.id = "box" + ( i + 1 );
        ib.style.opacity = 0;

        var p = document.createElement("p");
        p.setAttribute( 'class', 'title' );
        p.innerHTML = "Album " + "ABCDEFGHIJKLMNOPQRSTUVWXYZ".substr( i, 1 );
        ib.appendChild( p );

        p = document.createElement("p");
        p.setAttribute( 'class', 'points' );
        // p.style.textAlign = "right";
        p.innerHTML = ( Math.floor( Math.random() * 2000 ) + 1 );
        ib.appendChild( p );

        document.body.appendChild( ib );
    }

    setDay( 0 );
    setBoxPositions();
}

function setBoxPositions()
{
    // Get reference position
    var ref = document.getElementById( 'reference' );
    var refPos = getPosition( ref );
    // console.log( ref.offsetLeft + ', ' + ref.offsetTop + ' => ' + refPos.x + ', ' + refPos.y );


    for( let i = 0; i < 2 * itemCount; i++)
    {
        var box = document.getElementById( 'box' + ( i + 1 ).toString() );
        const pos = box.getAttribute( 'data-pos' );
        box.offsetHeight; // Force reflow so transitions are triggered
        // box.style.top = ( ( pos - 1 ) * 40 + itemMargin ) + 'px';
        // box.style.top = ( ( pos - 1 ) * 40 ) + 'px';
        // box.style.top = ( refPos.y + ( pos - 1 ) * 40 ) + 'px';
        // box.style.left = refPos.x + 'px';
        box.style.top = ( ref.offsetTop + ( pos - 1 ) * 40 ) + 'px';
        box.style.left = ref.offsetLeft + 'px';

        // Note: background image cannot be transitioned without extra tricks

        // Colour
        if( pos == 1 )
        {
            box.style.backgroundColor = numToColour( goldColour1 );
            box.style.color = numToColour( 0x191919 ); // maTextInfoColour );
            // box.style.backgroundImage = "linear-gradient( to right, " + numToColour( goldColour1 ) + ", " + numToColour( goldColour2 ) + ")";
            // box.style.backgroundImage = "linear-gradient(0deg, blue, green 40%, red)"; // linear-gradient( to right, red, orange )";
        }
        else if( pos == 2 )
        {
            box.style.backgroundColor = numToColour( silverColour3 );
            box.style.color = numToColour( 0x191919 ); // maTextInfoColour );
            // box.style.backgroundImage = 'linear-gradient(to right, white, white )';
        }
        else if( pos == 3 )
        {
            box.style.backgroundColor = numToColour( bronzeColour1 );
            box.style.color = numToColour( 0x191919 ); // maTextInfoColour );
            // box.style.backgroundImage = 'linear-gradient(to right, white, white )';
        }
        else
        {
            box.style.backgroundColor = numToColour( maBoxBackgroundColour2 ); // 'transparent';
            // box.style.backgroundImage = 'linear-gradient(to right, white, white )';
            box.style.color = numToColour( maTextBodyColour );
        }

        // Show ranked albums, hide others TODO: see how this looks, may hide too much
        if( pos >= 1 && pos <= itemCount )
        {
            box.style.opacity = 1;
        }
        else
        {
            box.style.opacity = 0;
        }
    }
}

function onSlide()
{
    var slider = document.getElementById("day_in_poll");
    setDay( slider.value );
    setBoxPositions();
}

function nextDay()
{
    if( currentDay < poll_results.length - 1 )
    {
        setDay( currentDay + 1 );
    }
}

function setDay( day )
{
    currentDay = Number( day );
    var slider = document.getElementById( "day_in_poll" );
    slider.value = currentDay;
    if( currentDay >= 0 )
    {
        setResults( poll_results[ currentDay ] );
    }
    else
    {
        // Should not happen
        var pollDay = document.getElementById("poll_day");
        pollDay.innerHTML = "Invalid";
    }
}

function setResults( result_set )
{
    var pollday = document.getElementById( 'poll_day' );
    pollday.innerHTML = result_set.polldate;

    var ballotcount = document.getElementById( 'ballot_count' );
    ballotcount.innerHTML = result_set.ballots + ( result_set.ballots == 1 ? ' ballot' : ' ballots' );

    // Mark positions of current in-view boxes (for reuse in next stage)
    for( let i = 0; i < 2 * itemCount; i++)
    {
        var box = document.getElementById( 'box' + ( i + 1 ) );
        if( box.getAttribute( 'data-pos' ) <= itemCount )
        {
            box.setAttribute( 'data-pos', -1 );
        }
    }

    // Set new vote positions, reuse box if album was previously in-view (data-pos = -1)
    for( let v = 0; v < itemCount && v < result_set.results.length; v++)
    {
        var band_album = result_set.results[ v ].band_album;
        var points = result_set.results[ v ].points;

        var found = false;
        for( let b = 0; b < 2 * itemCount && !found; b++)
        {
            var box = document.getElementById( 'box' + ( b + 1 ) );
            if( box.getAttribute( 'data-pos' ) == -1 )
            {
                var ps = box.querySelectorAll( 'p' );
                if( ps[ 0 ].innerHTML == band_album )
                {
                    // Found it, album stayed in results, update position and vote count
                    found = true;
                    box.setAttribute( 'data-pos', v + 1 );
                    ps[ 1 ].innerHTML = points;
                }
            }
        }

        if( !found )
        {
            // Album is new to results, assigned to out-of-view box 
            for( let b = 0; b < 2 * itemCount && !found; b++)
            {
                var box = document.getElementById( 'box' + ( b + 1 ) );
                if( box.getAttribute( 'data-pos' ) > itemCount )
                {
                    found = true;
                    box.setAttribute( 'data-pos', v + 1 );
                    var ps = box.querySelectorAll( 'p' );
                    ps[ 0 ].innerHTML = band_album;
                    ps[ 1 ].innerHTML = points;
                }
            }
        }
    }

    // Set positions of albums that have fallen out of the results (i.e. still -1)
    for( let b = 0; b < 2 * itemCount; b++)
    {
        var box = document.getElementById( 'box' + ( b + 1 ) );
        if( box.getAttribute( 'data-pos' ) == -1 )
        {
            box.setAttribute( 'data-pos', itemCount + 1 );
            var ps = box.querySelectorAll( 'p' );
            // Do no blank as want to see the album transition out
            // ps[ 0 ].innerHTML = '';
            // ps[ 1 ].innerHTML = '';
        }
    }
}

</script>
</head>
 
<body>
<h2>Metal Archives Top 10 Albums Poll Results 2025</h2>
<!--
    <div style='background-color: #208080' class="albumheader"><p class="result_pos"><b>Position</b></p><p class="title"><b>Album</b></p><p class="votes"><b>Votes</b></p></div>
-->
<div class="results_container" id="results_container" >
    <div class="container_header"><p><b>Place</b></p></div>
    <div class="container_header"><p><b>Album</b></p></div>
    <div class="container_header"><p><b>Points</b></p></div>

    <div id="reference" style="grid-row: 2; grid-column: 2; display: inline"></div>

</div>


<div id="spacer"></br></div>
<!--
<div id="spacer">a</br></br></br></br>b</div>
<div id="spacer" height="600px"></br></div>
-->

<!--
<div class="slidecontainer" width="100%" style="display: flex" >
-->
<div class="slidecontainer" style="display: flex; width: 780px" >
  <button style="margin-right: 5px" onclick="rewind()">⏮</button> 
  <button id="toggle_play" style="margin-right: 5px" onclick="togglePlay()">▶</button> 

  <input type="range" class="day_slider" id="day_in_poll" oninput="onSlide()">
  <div id="poll_day" style="margin-left: 10px">None</div>
  <div id="ballot_count" style="margin-left: auto; margin-right: 5px">nnn ballots</div>
</div>

<!-- Testing stuff -->
<div id="spacer"></br></div>
<div id="spacer"></br></div>
<div>
  <button onclick="create()">Create</button> 
  <button onclick="nextDay()">Next Day</button> 
  <button onclick="orderItems()">Order</button> 
  <button onclick="randomise()">Randomise</button> 
</div>

</body>

<script>
create();
</script>
</html>
